{% extends "base.html" %}

{% block content %}

<div class="groups-list">
    <h4>My Groups:</h4>
    {% for group in groups %}
    <div class="group-item {{ 'highlight' if group.id == current_group_id }}">
        {{ group.name }}
    </div>
    {% else %}
    <p>You are not in any groups.</p>
    {% endfor %}
</div>


<form method="post">
    {{ form.hidden_tag() }}
    <div class="form-group">
        <label for="group_name">Group Name</label>
        {{ form.group_name(class="form-control") }}
        {% if form.group_name.errors %}
            {% for error in form.group_name.errors %}
                <span style="color: red;">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div id="friends-cards" class="mt-3">
        <h4>Select Friends:</h4>
        {% for friend_id, friend_name in friends_choices %}
        <div class="friend-card" data-id="{{ friend_id }}">
            {{ friend_name }}
        </div>
        {% endfor %}
    </div>

    <!-- Hidden field to store selected friend IDs -->
    {{ form.selected_friends }}

    <!-- Submit button -->
    <button type="submit" class="btn btn-primary mt-3">Create Group</button>
</form>

<script>
    document.querySelectorAll('.friend-card').forEach(card => {
        card.addEventListener('click', function() {
            this.classList.toggle('selected'); // Toggle 'selected' class on click
            updateSelectedFriends(); // Update the hidden input with selected friend IDs
        });
    });

    function updateSelectedFriends() {
        // Collect IDs of all selected friends
        const selectedIds = Array.from(document.querySelectorAll('.friend-card.selected')).map(card => card.dataset.id);
        // Update the hidden input value
        document.querySelector('input[name="selected_friends"]').value = selectedIds.join(',');
    }
</script>
{% endblock %}